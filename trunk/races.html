<html>
  <head>
    <style type="text/css">
#menu, #main {
  position: fixed;
  top: 0;
  height: 600px;
  overflow: scroll;
  padding: 1%;
}
#menu {
  left: 0;
  width: 31%;
}
#main {
  left: 33%;
  width: 65%;
}
    </style>
    <!-- <script type="text/javascript" src="js/Game.js"></script> -->
    <script type="text/javascript">

var Game = {
  createElement: function (tagName, attributes, parentElement) {
    var newElement = document.createElement(tagName);
    for (attributeName in attributes) {
       newElement.setAttribute(attributeName, attributes[attributeName]);
    }
    if (parentElement) {
      parentElement.appendChild(newElement);
    }
    return newElement;
  },
  ajaxRequest: function (url, arguments, callback) {
    var body = "";
    // if arguments is a string, send it as the request body
    if (typeof (arguments) == "string") {
      body = arguments;
    }
    // if arguments is an object, combine its variables into a string
    else if (typeof (arguments) == "object") {
      var argumentList = [];
      for (var argumentName in arguments) {
        var argumentValue = encodeURIComponent(arguments[argumentName]);
        argumentList.push(argumentName + "=" + argumentValue);
      }
      body = argumentList.join("&");
    }
    // create and send the ajax request
    var ajax = new XMLHttpRequest();
    ajax.onreadystatechange = function () {
      if (ajax.readyState == 4) callback(ajax);
    };
    ajax.open("POST", url, true);
    ajax.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    ajax.send(body);
  },
};

    </script>
    <script type="text/javascript" src="js/TeamSprite.js"></script>
    <script type="text/javascript" src="js/Character.js"></script>
    <script type="text/javascript" src="js/ImageLoader.js"></script>
    <script type="text/javascript">

function serializeXML(xml) {
  var text = '';
  if (xml.nodeType == xml.ELEMENT_NODE) {
    text += '<' + xml.tagName;
    for (var i = 0; i < xml.attributes.length; i++) {
      text += ' ' + xml.attributes[i].name + '="' + xml.attributes[i].value + '"';
    }
    if (xml.hasChildNodes()) {
      text += '>';
      for (var j = 0; j < xml.childNodes.length; j++) {
        text += serializeXML(xml.childNodes[j]);
      }
      text += '</' + xml.tagName + '>';
    }
    else {
      text += '/' + '>';
    }
  }
  else if (xml.nodeType == xml.TEXT_NODE) {
    text += xml.textContent;
  }
  return text;
};

function showUnit(unit, main) {
  var row = Game.createElement('tr', {}, main);
  var cells = [
    Game.createElement('td', {'valign': 'top'}, row),
    Game.createElement('td', {'valign': 'top'}, row),
    Game.createElement('td', {'valign': 'middle', 'style': 'padding:36px'}, row),
    Game.createElement('td', {'valign': 'middle'}, row),
  ];
  Game.createElement('h3', {}, cells[0]).textContent = unit.name;
  for (var i = 0; i < unit.abilities.length; i++) {
    Game.createElement('div', {}, cells[0]).textContent = unit.abilities[i].level
      + " " + unit.abilities[i].name
      + ": " + unit.abilities[i].description;
  }
  cells[1].appendChild(unit.portrait);
  var rel = Game.createElement('div', {'style': 'position: relative'}, cells[2]);
  rel.appendChild(unit.element);
  for (var action in unit.sequences) {
    var link = Game.createElement('a', {'href': '#'},
      Game.createElement('div', {}, cells[3]));
    link.textContent = action;
    link.onclick = (
      function (x) {
        return function () {
          unit.setAction(x);
          unit.setFrame(0);
          return false;
        };
      }
    )(action);
  }
}

function Class(xml) {
  this.name = xml.getAttribute('name');
  this.elements = xml.getElementsByTagName('unit');
}
Class.prototype = {
  show: function (menu, main) {
    var line = Game.createElement('div', {}, menu);
    var link = Game.createElement('a', {'href': '#'}, line);
    link.textContent = this.name;
    var self = this;
    link.onclick = function () {
      main.innerHTML = '';
      Game.createElement('h2', {}, main).textContent = self.name;
      var tbody = Game.createElement('tbody', {},
        Game.createElement('table', {}, main))
      var units = [];
      for (var i = 0; i < self.elements.length; i++) {
        units.push(new Game.Character(self.elements[i]));
        showUnit(units[i], tbody);
      }
      if (window.animateClasses) clearInterval(window.animateClasses);
      window.animateClasses = setInterval(function () {
        for (var i = 0; i < units.length; i++) {
          units[i].animate();
        }
      }, 50);
      return false;
    };
  },
}

function Race(xml) {
  this.name = xml.getAttribute('name');
  this.classes = [];
  var classElements = xml.getElementsByTagName('class');
  for (var i = 0; i < classElements.length; i++) {
    this.classes.push(new Class(classElements[i]));
  }
}
Race.prototype = {
  show: function (menu, main) {
    Game.createElement('h1', {}, menu).textContent = this.name;
    for (var i = 0; i < this.classes.length; i++) {
      this.classes[i].show(menu, main);
    }
  },
}

function createRaces(xml) {
  var races = [];
  var raceElements = xml.getElementsByTagName('race');
  for (var i = 0; i < raceElements.length; i++) {
    races.push(new Race(raceElements[i]));
  }
  return races;
}

addEventListener('load', function () {
  Game.ajaxRequest('races.xml', {}, function (ajax) {
    Game.loader = new Game.ImageLoader(function () {
      return; // do stuff after all images are loaded
    });
    var menu = document.getElementById('menu');
    var main = document.getElementById('main');
    var races = createRaces(ajax.responseXML);
    for (var i = 0; i < races.length; i++) {
      races[i].show(menu, main);
    }
  });
}, true);

    </script>
    <link rel="stylesheet" type="text/css" href="game.css" />
  </head>
  <body>
    <div id="main"></div>
    <div id="menu"></div>
  </body>
</html>

